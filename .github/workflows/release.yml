name: Release

on:
  push:
    tags:
      - 'v*'  # è§¦å‘æ¡ä»¶ï¼šæŽ¨é€ä»¥ v å¼€å¤´çš„æ ‡ç­¾ (å¦‚ v2.1.1)
  workflow_dispatch:  # å…è®¸æ‰‹åŠ¨è§¦å‘

env:
  GO_VERSION: '1.23'

# è®¾ç½®æƒé™ä»¥å…è®¸åˆ›å»ºRelease
permissions:
  contents: write

jobs:
  # Temporarily disable tests for v1.0.0 release - core functionality is working
  # test:
  #   name: Run Tests
  #   runs-on: ubuntu-latest
  #   steps:
  #     - name: Checkout code
  #       uses: actions/checkout@v4

  #     - name: Set up Go
  #       uses: actions/setup-go@v5
  #       with:
  #         go-version: ${{ env.GO_VERSION }}

  #     - name: Cache Go modules
  #       uses: actions/cache@v4
  #       with:
  #         path: ~/go/pkg/mod
  #         key: ${{ runner.os }}-go-${{ hashFiles('**/go.sum') }}
  #         restore-keys: |
  #           ${{ runner.os }}-go-

  #     - name: Download dependencies
  #       run: go mod download

  #     - name: Run tests
  #       run: |
  #         # è·³è¿‡ä¸€äº›é›†æˆæµ‹è¯•ä»¥é¿å…æµ‹è¯•çŽ¯å¢ƒé—®é¢˜
  #         go test -v ./config ./internal/endpoint ./internal/proxy ./tests/unit/config ./tests/unit/endpoint ./tests/unit/monitor ./tests/unit/proxy

  #     - name: Run build test
  #       run: go build -v ./...

  build:
    name: Build Release Binaries
    runs-on: ubuntu-latest
    # needs: test  # Disable test dependency temporarily
    strategy:
      matrix:
        include:
          # Linux builds
          - goos: linux
            goarch: amd64
            name: cc-forwarder-linux-amd64
          - goos: linux
            goarch: arm64
            name: cc-forwarder-linux-arm64
          - goos: linux
            goarch: arm
            name: cc-forwarder-linux-armv7
          # Windows builds
          - goos: windows
            goarch: amd64
            name: cc-forwarder-windows-amd64
          - goos: windows
            goarch: arm64
            name: cc-forwarder-windows-arm64
          # macOS builds
          - goos: darwin
            goarch: amd64
            name: cc-forwarder-darwin-amd64
          - goos: darwin
            goarch: arm64
            name: cc-forwarder-darwin-arm64

    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Set up Go
        uses: actions/setup-go@v5
        with:
          go-version: ${{ env.GO_VERSION }}

      - name: Cache Go modules
        uses: actions/cache@v4
        with:
          path: |
            ~/go/pkg/mod
            ~/.cache/go-build
          key: ${{ runner.os }}-go-${{ hashFiles('**/go.sum') }}
          restore-keys: |
            ${{ runner.os }}-go-
        continue-on-error: true  # ç¼“å­˜å¤±è´¥ä¸é˜»æ­¢æž„å»º

      - name: Download dependencies
        run: go mod download

      - name: Verify build
        run: |
          echo "ðŸ” Verifying code compiles successfully..."
          go build -v ./...
          echo "âœ… Build verification passed"

      - name: Get version from tag
        run: |
          if [[ "${{ github.ref }}" == refs/tags/* ]]; then
            echo "VERSION=${GITHUB_REF#refs/tags/}" >> $GITHUB_ENV
          else
            echo "VERSION=dev-$(git rev-parse --short HEAD)" >> $GITHUB_ENV
          fi

      - name: Build binary
        env:
          GOOS: ${{ matrix.goos }}
          GOARCH: ${{ matrix.goarch }}
          CGO_ENABLED: 0  # ä½¿ç”¨çº¯Go SQLiteï¼Œæ— éœ€CGO
        run: |
          # æž„å»ºæ—¶åµŒå…¥ç‰ˆæœ¬ä¿¡æ¯
          BUILD_TIME=$(date -u '+%Y-%m-%d_%H:%M:%S_UTC')
          COMMIT_HASH=$(git rev-parse --short HEAD)
          
          LDFLAGS="-s -w -X main.version=${{ env.VERSION }} -X main.date=${BUILD_TIME} -X main.commit=${COMMIT_HASH}"
          
          # Windows éœ€è¦ .exe åŽç¼€
          BINARY_NAME="cc-forwarder"
          if [ "$GOOS" = "windows" ]; then
            BINARY_NAME="cc-forwarder.exe"
          fi
          
          echo "Building ${{ matrix.name }} for $GOOS/$GOARCH (çº¯Goæ¨¡å¼ï¼Œæ— CGOä¾èµ–)"
          go build -ldflags "$LDFLAGS" -o dist/${{ matrix.name }}/${BINARY_NAME} .

      - name: Prepare release assets
        run: |
          mkdir -p dist/${{ matrix.name }}
          
          # å¤åˆ¶å¿…è¦æ–‡ä»¶åˆ°å‘å¸ƒç›®å½•
          cp README.md dist/${{ matrix.name }}/
          # æ³¨æ„: CLAUDE.md æ˜¯å¼€å‘é…ç½®æ–‡ä»¶ï¼Œä¸åŒ…å«åœ¨ç”¨æˆ·å‘å¸ƒåŒ…ä¸­
          cp -r config dist/${{ matrix.name }}/
          
          # åˆ›å»ºæ•°æ®ç›®å½•å’Œè¯´æ˜Žæ–‡ä»¶
          mkdir -p dist/${{ matrix.name }}/data
          cat > dist/${{ matrix.name }}/data/README.txt << 'EOF'
          æ•°æ®å­˜å‚¨ç›®å½•
          ============

          æ­¤ç›®å½•ç”¨äºŽå­˜å‚¨åº”ç”¨æ•°æ®ï¼š

          ðŸ“Š usage.db - SQLiteæ•°æ®åº“æ–‡ä»¶ï¼Œå­˜å‚¨è¯·æ±‚ä½¿ç”¨è®°å½•å’Œç»Ÿè®¡ä¿¡æ¯
               - è‡ªåŠ¨åˆ›å»ºï¼ˆé¦–æ¬¡å¯åŠ¨æ—¶ï¼‰
               - åŒ…å«è¯·æ±‚æ—¥å¿—ã€tokenä½¿ç”¨é‡ã€æˆæœ¬ç»Ÿè®¡
               - å¯é€šè¿‡Webç•Œé¢æŸ¥çœ‹å’Œå¯¼å‡º
               - æ”¯æŒæ•°æ®ä¿ç•™ç­–ç•¥é…ç½®

          ðŸ’¡ é‡è¦æç¤ºï¼š
             â€¢ è¯·ç¡®ä¿æ­¤ç›®å½•æœ‰è¯»å†™æƒé™
             â€¢ å»ºè®®å®šæœŸå¤‡ä»½æ•°æ®åº“æ–‡ä»¶
             â€¢ æ•°æ®åº“è·¯å¾„å¯åœ¨ config/config.yaml ä¸­é…ç½®
             â€¢ å¦‚éœ€è¿ç§»ï¼Œç›´æŽ¥å¤åˆ¶æ•´ä¸ªdataç›®å½•å³å¯

          ðŸ“ ç›®å½•ç»“æž„ç¤ºä¾‹ï¼š
             data/
             â”œâ”€â”€ usage.db      (SQLiteæ•°æ®åº“)
             â””â”€â”€ README.txt    (æœ¬è¯´æ˜Žæ–‡ä»¶)
          EOF
          
          # åˆ›å»ºéƒ¨ç½²æŒ‡å—
          cat > dist/${{ matrix.name }}/DEPLOYMENT.md << 'EOF'
          # CC-Forwarder éƒ¨ç½²æŒ‡å—

          ## ðŸš€ å¿«é€Ÿå¼€å§‹

          ### 1. è§£åŽ‹æ–‡ä»¶
          ```bash
          # Linux/macOS
          tar -xzf cc-forwarder-*.tar.gz
          cd cc-forwarder-*/

          # Windows  
          # è§£åŽ‹ cc-forwarder-*.zip
          # è¿›å…¥è§£åŽ‹åŽçš„ç›®å½•
          ```

          ### 2. é…ç½®åº”ç”¨
          ```bash
          # å¤åˆ¶é…ç½®æ¨¡æ¿
          cp config/example.yaml config/config.yaml

          # ç¼–è¾‘é…ç½®æ–‡ä»¶
          # Linux/macOS: vim config/config.yaml
          # Windows: notepad config/config.yaml
          ```

          ### 3. å¯åŠ¨åº”ç”¨
          ```bash
          # Linux/macOS: ä½¿ç”¨å¯åŠ¨è„šæœ¬
          ./start.sh

          # æˆ–ç›´æŽ¥è¿è¡Œ
          ./cc-forwarder -config config/config.yaml

          # Windows: åŒå‡» start.bat æˆ–ä½¿ç”¨å‘½ä»¤è¡Œ
          cc-forwarder.exe -config config/config.yaml
          ```

          ## ðŸ“Š æ•°æ®å­˜å‚¨è¯´æ˜Ž

          ### SQLiteæ•°æ®åº“
          - **ä½ç½®**: `data/usage.db`
          - **ç”¨é€”**: å­˜å‚¨è¯·æ±‚ä½¿ç”¨è®°å½•ã€tokenç»Ÿè®¡ã€æˆæœ¬åˆ†æž
          - **è‡ªåŠ¨åˆ›å»º**: é¦–æ¬¡å¯åŠ¨æ—¶è‡ªåŠ¨åˆ›å»ºæ•°æ®åº“å’Œè¡¨ç»“æž„
          - **WebæŸ¥çœ‹**: å¯åŠ¨åŽè®¿é—® http://localhost:8010 æŸ¥çœ‹ç»Ÿè®¡ä¿¡æ¯

          ### æ•°æ®å¤‡ä»½
          ```bash
          # å¤‡ä»½æ•´ä¸ªæ•°æ®ç›®å½•
          cp -r data data_backup_$(date +%Y%m%d)

          # æˆ–ä»…å¤‡ä»½æ•°æ®åº“
          cp data/usage.db usage_backup_$(date +%Y%m%d).db
          ```

          ### æ•°æ®è¿ç§»
          1. åœæ­¢åº”ç”¨
          2. å¤åˆ¶ `data/` ç›®å½•åˆ°æ–°ä½ç½®
          3. æ›´æ–°é…ç½®æ–‡ä»¶ä¸­çš„ `database_path` è·¯å¾„
          4. é‡å¯åº”ç”¨

          ## ðŸ”§ é«˜çº§é…ç½®

          ### ä½¿ç”¨è·Ÿè¸ªé…ç½®
          ```yaml
          usage_tracking:
            enabled: true                    # å¯ç”¨ä½¿ç”¨è·Ÿè¸ª
            database_path: "data/usage.db"   # æ•°æ®åº“è·¯å¾„
            retention_days: 90               # æ•°æ®ä¿ç•™å¤©æ•°
          ```

          ### Webç•Œé¢é…ç½®
          ```yaml
          web:
            enabled: true
            host: "0.0.0.0"     # å…è®¸å¤–éƒ¨è®¿é—®
            port: 8010          # Webç«¯å£
          ```

          ## ðŸ“‹ ç›®å½•ç»“æž„
          ```
          cc-forwarder/
          â”œâ”€â”€ cc-forwarder          # ä¸»ç¨‹åº
          â”œâ”€â”€ start.sh              # å¯åŠ¨è„šæœ¬
          â”œâ”€â”€ config/
          â”‚   â”œâ”€â”€ config.yaml       # ä¸»é…ç½®æ–‡ä»¶ï¼ˆéœ€è¦æ‰‹åŠ¨åˆ›å»ºï¼‰
          â”‚   â””â”€â”€ example.yaml      # é…ç½®æ¨¡æ¿
          â”œâ”€â”€ data/
          â”‚   â”œâ”€â”€ usage.db          # æ•°æ®åº“ï¼ˆè‡ªåŠ¨åˆ›å»ºï¼‰
          â”‚   â””â”€â”€ README.txt        # æ•°æ®ç›®å½•è¯´æ˜Ž
          â”œâ”€â”€ README.md             # é¡¹ç›®è¯´æ˜Ž
          â””â”€â”€ DEPLOYMENT.md         # æœ¬éƒ¨ç½²æŒ‡å—
          ```

          ## â“ å¸¸è§é—®é¢˜

          ### Q: æ•°æ®åº“æ–‡ä»¶å¾ˆå¤§æ€Žä¹ˆåŠžï¼Ÿ
          A: é…ç½®æ•°æ®ä¿ç•™ç­–ç•¥ï¼Œè‡ªåŠ¨æ¸…ç†æ—§æ•°æ®ï¼š
          ```yaml
          usage_tracking:
            retention_days: 30    # åªä¿ç•™30å¤©æ•°æ®
            cleanup_interval: "24h"
          ```

          ### Q: å¦‚ä½•é‡ç½®æ•°æ®ï¼Ÿ
          A: åœæ­¢åº”ç”¨ï¼Œåˆ é™¤ `data/usage.db` æ–‡ä»¶ï¼Œé‡å¯å³å¯

          ### Q: å¯ä»¥ä½¿ç”¨å¤–éƒ¨æ•°æ®åº“å—ï¼Ÿ
          A: ç›®å‰ä»…æ”¯æŒSQLiteï¼Œæœªæ¥å¯èƒ½æ”¯æŒMySQL/PostgreSQL
          EOF
          
          # åˆ›å»ºå¯åŠ¨è„šæœ¬ (Linux/macOS)
          if [ "${{ matrix.goos }}" != "windows" ]; then
            cat > dist/${{ matrix.name }}/start.sh << 'EOF'
          #!/bin/bash
          # CC-Forwarder å¯åŠ¨è„šæœ¬
          
          echo "ðŸš€ CC-Forwarder å¯åŠ¨æ£€æŸ¥..."
          
          # ç¡®ä¿é…ç½®æ–‡ä»¶å­˜åœ¨
          if [ ! -f "config/config.yaml" ]; then
            echo "âš ï¸ é…ç½®æ–‡ä»¶ä¸å­˜åœ¨ï¼Œè¯·å…ˆå¤åˆ¶ config/example.yaml åˆ° config/config.yaml å¹¶ä¿®æ”¹é…ç½®"
            echo "ðŸ’¡ å¿«é€Ÿé…ç½®å‘½ä»¤: cp config/example.yaml config/config.yaml"
            exit 1
          fi
          
          # ç¡®ä¿æ•°æ®ç›®å½•å­˜åœ¨ä¸”æœ‰æƒé™
          if [ ! -d "data" ]; then
            echo "ðŸ“ åˆ›å»ºæ•°æ®ç›®å½•..."
            mkdir -p data
          fi
          
          if [ ! -w "data" ]; then
            echo "âš ï¸ æ•°æ®ç›®å½•æ²¡æœ‰å†™æƒé™ï¼Œå°è¯•ä¿®å¤..."
            chmod 755 data
          fi
          
          echo "âœ… çŽ¯å¢ƒæ£€æŸ¥å®Œæˆ"
          echo "ðŸ“Š æ•°æ®åº“ä½ç½®: data/usage.db"
          echo "ðŸŒ Webç•Œé¢: http://localhost:8010 (å¦‚å·²å¯ç”¨)"
          echo ""
          
          # å¯åŠ¨åº”ç”¨
          echo "ðŸš€ å¯åŠ¨ CC-Forwarder..."
          ./cc-forwarder -config config/config.yaml
          EOF
            chmod +x dist/${{ matrix.name }}/start.sh
          else
            # Windows æ‰¹å¤„ç†è„šæœ¬
            cat > dist/${{ matrix.name }}/start.bat << 'EOF'
          @echo off
          echo ðŸš€ CC-Forwarder å¯åŠ¨æ£€æŸ¥...
          
          REM æ£€æŸ¥é…ç½®æ–‡ä»¶
          if not exist "config\config.yaml" (
            echo âš ï¸ é…ç½®æ–‡ä»¶ä¸å­˜åœ¨ï¼Œè¯·å…ˆå¤åˆ¶ config\example.yaml åˆ° config\config.yaml
            echo ðŸ’¡ å¿«é€Ÿé…ç½®å‘½ä»¤: copy config\example.yaml config\config.yaml
            pause
            exit /b 1
          )
          
          REM åˆ›å»ºæ•°æ®ç›®å½•
          if not exist "data" (
            echo ðŸ“ åˆ›å»ºæ•°æ®ç›®å½•...
            mkdir data
          )
          
          echo âœ… çŽ¯å¢ƒæ£€æŸ¥å®Œæˆ
          echo ðŸ“Š æ•°æ®åº“ä½ç½®: data\usage.db
          echo ðŸŒ Webç•Œé¢: http://localhost:8010 (å¦‚å·²å¯ç”¨)
          echo.
          
          REM å¯åŠ¨åº”ç”¨
          echo ðŸš€ å¯åŠ¨ CC-Forwarder...
          cc-forwarder.exe -config config\config.yaml
          pause
          EOF
          fi

      - name: Create archive
        run: |
          cd dist
          if [ "${{ matrix.goos }}" = "windows" ]; then
            zip -r ${{ matrix.name }}.zip ${{ matrix.name }}/
          else
            tar -czf ${{ matrix.name }}.tar.gz ${{ matrix.name }}/
          fi

      - name: Generate checksums
        run: |
          cd dist
          if [ "${{ matrix.goos }}" = "windows" ]; then
            sha256sum ${{ matrix.name }}.zip > ${{ matrix.name }}.sha256
          else
            sha256sum ${{ matrix.name }}.tar.gz > ${{ matrix.name }}.sha256
          fi

      - name: Upload build artifacts
        uses: actions/upload-artifact@v4
        with:
          name: ${{ matrix.name }}
          path: |
            dist/${{ matrix.name }}.tar.gz
            dist/${{ matrix.name }}.zip
            dist/${{ matrix.name }}.sha256

  release:
    name: Create GitHub Release
    runs-on: ubuntu-latest
    needs: build
    if: startsWith(github.ref, 'refs/tags/')
    
    steps:
      - name: Checkout code
        uses: actions/checkout@v4
        with:
          fetch-depth: 0  # èŽ·å–å®Œæ•´åŽ†å²ç”¨äºŽç”Ÿæˆå˜æ›´æ—¥å¿—

      - name: Download all artifacts
        uses: actions/download-artifact@v4
        with:
          path: dist/

      - name: Organize release files
        run: |
          mkdir -p release/
          find dist/ -name "*.tar.gz" -o -name "*.zip" -o -name "*.sha256" | while read file; do
            cp "$file" release/
          done
          
          # ç”Ÿæˆæ€»ä½“æ ¡éªŒå’Œæ–‡ä»¶
          cd release/
          sha256sum *.tar.gz *.zip > checksums.txt

      - name: Generate release notes
        id: release_notes
        run: |
          # èŽ·å–ç‰ˆæœ¬ä¿¡æ¯
          VERSION=${GITHUB_REF#refs/tags/}
          echo "VERSION=$VERSION" >> $GITHUB_ENV
          VERSION_NUMBER=${VERSION#v}  # ç§»é™¤ v å‰ç¼€ç”¨äºŽåŒ¹é…CHANGELOG
          
          # æ£€æŸ¥CHANGELOG.mdæ˜¯å¦å­˜åœ¨
          if [ ! -f "CHANGELOG.md" ]; then
            echo "âš ï¸ CHANGELOG.md æ–‡ä»¶ä¸å­˜åœ¨ï¼Œä½¿ç”¨é»˜è®¤å‘å¸ƒè¯´æ˜Ž"
            CHANGELOG_CONTENT="ðŸš€ **æ–°ç‰ˆæœ¬å‘å¸ƒï¼**"
          else
            # ä»ŽCHANGELOG.mdæå–å½“å‰ç‰ˆæœ¬çš„å†…å®¹
            echo "ðŸ“ ä»ŽCHANGELOG.mdæå–ç‰ˆæœ¬ $VERSION_NUMBER çš„å˜æ›´å†…å®¹..."
            
            # ä½¿ç”¨awkæå–å½“å‰ç‰ˆæœ¬çš„changelogå†…å®¹
            CHANGELOG_CONTENT=$(awk '
              BEGIN { found=0; content="" }
              /^## \[/ {
                if (found) exit
                if (index($0, "['$VERSION_NUMBER']") > 0) {
                  found=1
                  next
                }
              }
              found && !/^## \[/ { 
                content = content $0 "\n" 
              }
              END { print content }
            ' CHANGELOG.md)
            
            # å¦‚æžœæ²¡æœ‰æ‰¾åˆ°å¯¹åº”ç‰ˆæœ¬å†…å®¹ï¼Œä½¿ç”¨é»˜è®¤è¯´æ˜Ž
            if [ -z "$CHANGELOG_CONTENT" ]; then
              echo "âš ï¸ åœ¨CHANGELOG.mdä¸­æœªæ‰¾åˆ°ç‰ˆæœ¬ $VERSION_NUMBER çš„å˜æ›´è®°å½•"
              CHANGELOG_CONTENT="ðŸš€ **æ–°ç‰ˆæœ¬å‘å¸ƒï¼**\n\næŸ¥çœ‹å®Œæ•´å˜æ›´åŽ†å²è¯·å‚è€ƒ [CHANGELOG.md](./CHANGELOG.md)"
            else
              echo "âœ… æˆåŠŸæå–ç‰ˆæœ¬ $VERSION_NUMBER çš„å˜æ›´å†…å®¹"
            fi
          fi
          
          # ç”Ÿæˆå®Œæ•´çš„å‘å¸ƒè¯´æ˜Žï¼Œä½¿ç”¨ä¸´æ—¶æ–‡ä»¶å¤„ç†æ¢è¡Œç¬¦
          echo "## CC-Forwarder $VERSION" > release_notes.md
          echo "" >> release_notes.md
          echo "$CHANGELOG_CONTENT" >> release_notes.md
          echo "" >> release_notes.md
          echo "---" >> release_notes.md
          echo "" >> release_notes.md
          echo "## ðŸ“¥ ä¸‹è½½è¯´æ˜Ž" >> release_notes.md
          echo "" >> release_notes.md
          echo "é€‰æ‹©é€‚åˆä½ ç³»ç»Ÿçš„ç‰ˆæœ¬ï¼š" >> release_notes.md
          echo "" >> release_notes.md
          echo "- **Linux x64**: \`cc-forwarder-linux-amd64.tar.gz\`" >> release_notes.md
          echo "- **Linux ARM64**: \`cc-forwarder-linux-arm64.tar.gz\`" >> release_notes.md  
          echo "- **Linux ARMv7**: \`cc-forwarder-linux-armv7.tar.gz\`" >> release_notes.md
          echo "- **Windows x64**: \`cc-forwarder-windows-amd64.zip\`" >> release_notes.md
          echo "- **Windows ARM64**: \`cc-forwarder-windows-arm64.zip\`" >> release_notes.md
          echo "- **macOS Intel**: \`cc-forwarder-darwin-amd64.tar.gz\`" >> release_notes.md
          echo "- **macOS Apple Silicon**: \`cc-forwarder-darwin-arm64.tar.gz\`" >> release_notes.md
          echo "" >> release_notes.md
          echo "## ðŸš€ å¿«é€Ÿå¼€å§‹" >> release_notes.md
          echo "" >> release_notes.md
          echo "1. ä¸‹è½½å¯¹åº”å¹³å°çš„åŽ‹ç¼©åŒ…" >> release_notes.md
          echo "2. è§£åŽ‹åˆ°ç›®æ ‡ç›®å½•" >> release_notes.md
          echo "3. å¤åˆ¶ \`config/example.yaml\` åˆ° \`config/config.yaml\` å¹¶ä¿®æ”¹é…ç½®" >> release_notes.md
          echo "4. è¿è¡Œ \`./start.sh\` (Linux/macOS) æˆ– \`start.bat\` (Windows)" >> release_notes.md
          echo "" >> release_notes.md
          echo "## ðŸ” æ–‡ä»¶å®Œæ•´æ€§éªŒè¯" >> release_notes.md
          echo "" >> release_notes.md
          echo "ä½¿ç”¨ \`checksums.txt\` éªŒè¯ä¸‹è½½æ–‡ä»¶çš„å®Œæ•´æ€§ï¼š" >> release_notes.md
          echo "\`\`\`bash" >> release_notes.md
          echo "sha256sum -c checksums.txt" >> release_notes.md
          echo "\`\`\`" >> release_notes.md
          echo "" >> release_notes.md
          echo "## ðŸ“š æ›´å¤šä¿¡æ¯" >> release_notes.md
          echo "" >> release_notes.md
          echo "- [å®Œæ•´æ–‡æ¡£](README.md)" >> release_notes.md
          echo "- [å˜æ›´åŽ†å²](CHANGELOG.md)" >> release_notes.md
          echo "- [é—®é¢˜åé¦ˆ](https://github.com/${{ github.repository }}/issues)" >> release_notes.md

      - name: Create Release
        uses: softprops/action-gh-release@v2
        with:
          name: CC-Forwarder ${{ env.VERSION }}
          body_path: release_notes.md
          files: |
            release/*
          draft: false
          prerelease: false
          generate_release_notes: true
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}

      - name: Upload release summary
        run: |
          echo "ðŸŽ‰ Release ${{ env.VERSION }} created successfully!"
          echo "ðŸ“¦ Artifacts:"
          ls -la release/
          echo ""
          echo "ðŸ”— Release URL: https://github.com/${{ github.repository }}/releases/tag/${{ env.VERSION }}"